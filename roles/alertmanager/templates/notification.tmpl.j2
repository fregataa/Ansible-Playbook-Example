{{ "{{" }} /* Slack Templates */ {{ "}}" }}

{{ "{{" }} define "slack.title" {{ "}}" }}
[{{ "{{ .Status | toUpper }}" }}{{ "{{ if eq .Status \"firing\" }}" }}:{{ "{{ .Alerts.Firing | len }}" }}{{ "{{ end }}" }}] {{ "{{ .GroupLabels.alertname }}" }}
{{ "{{" }} end {{ "}}" }}

{{ "{{" }} define "slack.text" {{ "}}" }}
{{ "{{" }} range .Alerts {{ "}}" }}
*Alert:* {{ "{{ .Annotations.summary }}" }}
*Severity:* {{ "{{ .Labels.severity }}" }}
*Instance:* {{ "{{ .Labels.instance }}" }}
*Description:* {{ "{{ .Annotations.description }}" }}
{{ "{{" }} if .Labels.gpu {{ "}}" }}*GPU:* {{ "{{ .Labels.gpu }}" }}{{ "{{" }} end {{ "}}" }}
{{ "{{" }} end {{ "}}" }}
{{ "{{" }} end {{ "}}" }}

{{ "{{" }} define "slack.gpu.title" {{ "}}" }}
[{{ "{{ .Status | toUpper }}" }}] GPU Alert: {{ "{{ .GroupLabels.alertname }}" }}
{{ "{{" }} end {{ "}}" }}

{{ "{{" }} define "slack.gpu.text" {{ "}}" }}
{{ "{{" }} range .Alerts {{ "}}" }}
*Alert:* {{ "{{ .Annotations.summary }}" }}
*Severity:* `{{ "{{ .Labels.severity }}" }}`
*Node:* {{ "{{ .Labels.instance }}" }}
{{ "{{" }} if .Labels.gpu {{ "}}" }}*GPU:* {{ "{{ .Labels.gpu }}" }}{{ "{{" }} end {{ "}}" }}
*Description:* {{ "{{ .Annotations.description }}" }}
{{ "{{" }} end {{ "}}" }}

_Cluster: {{ cluster_name }}_
{{ "{{" }} end {{ "}}" }}

{{ "{{" }} define "slack.color" {{ "}}" }}
{{ "{{" }} if eq .Status "firing" {{ "}}" }}
{{ "{{" }} if eq (index .Alerts 0).Labels.severity "critical" {{ "}}" }}danger{{ "{{" }} else if eq (index .Alerts 0).Labels.severity "warning" {{ "}}" }}warning{{ "{{" }} else {{ "}}" }}#439FE0{{ "{{" }} end {{ "}}" }}
{{ "{{" }} else {{ "}}" }}good{{ "{{" }} end {{ "}}" }}
{{ "{{" }} end {{ "}}" }}

{{ "{{" }} /* Email Templates */ {{ "}}" }}

{{ "{{" }} define "email.html" {{ "}}" }}
<!DOCTYPE html>
<html>
<head>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    .header { background-color: {{ "{{" }} if eq .Status "firing" {{ "}}" }}#dc3545{{ "{{" }} else {{ "}}" }}#28a745{{ "{{" }} end {{ "}}" }}; color: white; padding: 15px; border-radius: 5px; }
    .alert { border: 1px solid #ddd; padding: 15px; margin: 10px 0; border-radius: 5px; }
    .critical { border-left: 5px solid #dc3545; }
    .warning { border-left: 5px solid #ffc107; }
    .info { border-left: 5px solid #17a2b8; }
    .label { font-weight: bold; }
    .footer { margin-top: 20px; font-size: 12px; color: #666; }
  </style>
</head>
<body>
  <div class="header">
    <h2>{{ "{{" }} .Status | toUpper {{ "}}" }}: {{ "{{ .GroupLabels.alertname }}" }}</h2>
    <p>Cluster: {{ cluster_name }}</p>
  </div>

  {{ "{{" }} range .Alerts {{ "}}" }}
  <div class="alert {{ "{{ .Labels.severity }}" }}">
    <p><span class="label">Alert:</span> {{ "{{ .Annotations.summary }}" }}</p>
    <p><span class="label">Severity:</span> {{ "{{ .Labels.severity }}" }}</p>
    <p><span class="label">Instance:</span> {{ "{{ .Labels.instance }}" }}</p>
    {{ "{{" }} if .Labels.gpu {{ "}}" }}<p><span class="label">GPU:</span> {{ "{{ .Labels.gpu }}" }}</p>{{ "{{" }} end {{ "}}" }}
    <p><span class="label">Description:</span> {{ "{{ .Annotations.description }}" }}</p>
    <p><span class="label">Started:</span> {{ "{{ .StartsAt.Format \"2006-01-02 15:04:05 MST\" }}" }}</p>
  </div>
  {{ "{{" }} end {{ "}}" }}

  <div class="footer">
    <p>Generated by Alertmanager - GPU Cluster Monitoring</p>
  </div>
</body>
</html>
{{ "{{" }} end {{ "}}" }}
